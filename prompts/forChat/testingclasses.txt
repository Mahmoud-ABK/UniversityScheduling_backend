package com.scheduling.universityschedule_backend.testingclasses;



import com.scheduling.universityschedule_backend.dto.*;
import com.scheduling.universityschedule_backend.exception.CustomException;
import com.scheduling.universityschedule_backend.mapper.EntityMapper;
import com.scheduling.universityschedule_backend.model.*;
import com.scheduling.universityschedule_backend.repository.*;
import com.scheduling.universityschedule_backend.util.CustomLogger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Component
@Transactional
public class EntityMapperTester {

    @Autowired
    private EntityMapper entityMapper;
    @Autowired
    private PersonneRepository personneRepository;
    @Autowired
    private EnseignantRepository enseignantRepository;
    @Autowired
    private BrancheRepository brancheRepository;
    @Autowired
    private SalleRepository salleRepository;
    @Autowired
    private SeanceRepository seanceRepository;
    @Autowired
    private TDRepository tdRepository;
    @Autowired
    private TPRepository tpRepository;
    @Autowired
    private SignalRepository signalRepository;
    @Autowired
    private PropositionDeRattrapageRepository propositionDeRattrapageRepository;
    @Autowired
    private NotificationRepository notificationRepository;
    @Autowired
    private FichierExcelRepository fichierExcelRepository;

    public void testEntityMapper() throws CustomException {
        CustomLogger.logInfo("=================== Testing Entity Mapper (Both Ways) ====================");

        // Fetch entities from the database (assuming each repository returns a non-empty list)
        Personne personne = personneRepository.findAll().getFirst();
        Enseignant enseignant = enseignantRepository.findAll().getFirst();
        Branche branche = brancheRepository.findAll().getFirst();
        Salle salle = salleRepository.findAll().getFirst();
        Seance seance = seanceRepository.findAll().getFirst();
        TD td = tdRepository.findAll().getFirst();
        TP tp = tpRepository.findAll().getFirst();
        Signal signal = signalRepository.findAll().getFirst();
        PropositionDeRattrapage proposition = propositionDeRattrapageRepository.findAll().getFirst();
        Notification notification = notificationRepository.findAll().getFirst();
        FichierExcel fichierExcel = fichierExcelRepository.findAll().getFirst();

        // --- Mapping: Entity -> DTO ---
        PersonneDTO personneDTO = entityMapper.toPersonneDTO(personne);
        CustomLogger.logInfo("Entity -> DTO | PersonneDTO: " + personneDTO);

        EnseignantDTO enseignantDTO = entityMapper.toEnseignantDTO(enseignant);
        CustomLogger.logInfo("Entity -> DTO | EnseignantDTO: " + enseignantDTO);


        BrancheDTO brancheDTO = entityMapper.toBrancheDTO(branche);
        CustomLogger.logInfo("Entity -> DTO | BrancheDTO: " + brancheDTO);

        SalleDTO salleDTO = entityMapper.toSalleDTO(salle);
        CustomLogger.logInfo("Entity -> DTO | SalleDTO: " + salleDTO);

        SeanceDTO seanceDTO = entityMapper.toSeanceDTO(seance);
        CustomLogger.logInfo("Entity -> DTO | SeanceDTO: " + seanceDTO);

        TDDTO tdDTO = entityMapper.toTDDTO(td);
        CustomLogger.logInfo("Entity -> DTO | TDDTO: " + tdDTO);

        TPDTO tpDTO = entityMapper.toTPDTO(tp);
        CustomLogger.logInfo("Entity -> DTO | TPDTO: " + tpDTO);

        SignalDTO signalDTO = entityMapper.toSignalDTO(signal);
        CustomLogger.logInfo("Entity -> DTO | SignalDTO: " + signalDTO);

        PropositionDeRattrapageDTO propositionDTO = entityMapper.toPropositionDeRattrapageDTO(proposition);
        CustomLogger.logInfo("Entity -> DTO | PropositionDeRattrapageDTO: " + propositionDTO);

        NotificationDTO notificationDTO = entityMapper.toNotificationDTO(notification);
        CustomLogger.logInfo("Entity -> DTO | NotificationDTO: " + notificationDTO);

        FichierExcelDTO fichierExcelDTO = entityMapper.toFichierExcelDTO(fichierExcel);
        CustomLogger.logInfo("Entity -> DTO | FichierExcelDTO: " + fichierExcelDTO);

        CustomLogger.logInfo("Mapping from DTO to Entity========================================================");
        // --- Mapping: DTO -> Entity ---
        Personne mappedPersonne = entityMapper.toPersonne(personneDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Personne: " + mappedPersonne);

        Enseignant mappedEnseignant = entityMapper.toEnseignant(enseignantDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Enseignant: " + mappedEnseignant);
        mappedEnseignant.getSeances().forEach(seance1 -> CustomLogger.logInfo("examining datafetching " + seance1 + "\n"));
        Branche mappedBranche = entityMapper.toBranche(brancheDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Branche: " + mappedBranche);

        Salle mappedSalle = entityMapper.toSalle(salleDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Salle: " + mappedSalle);

        Seance mappedSeance = entityMapper.toSeance(seanceDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Seance: " + mappedSeance);

        TD mappedTD = entityMapper.toTD(tdDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped TD: " + mappedTD);

        TP mappedTP = entityMapper.toTP(tpDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped TP: " + mappedTP);

        Signal mappedSignal = entityMapper.toSignal(signalDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Signal: " + mappedSignal);

        PropositionDeRattrapage mappedProposition = entityMapper.toPropositionDeRattrapage(propositionDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped PropositionDeRattrapage: " + mappedProposition);

        Notification mappedNotification = entityMapper.toNotification(notificationDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped Notification: " + mappedNotification);

        FichierExcel mappedFichierExcel = entityMapper.toFichierExcel(fichierExcelDTO);
        CustomLogger.logInfo("DTO -> Entity | Mapped FichierExcel: " + mappedFichierExcel);

        CustomLogger.logInfo("=================== Finished Entity Mapping Test ===================");
    }

    public void testConflictMappings() throws CustomException {
        CustomLogger.logInfo("=========== testing conflict mapping ==================");
        // Fetch conflicting seance pairs
        List<Object[]> conflictPairs = seanceRepository.findConflictingSeancePairs(FrequenceType.BIWEEKLY,FrequenceType.CATCHUP);
        List<SeanceConflictDTO> seanceConflictDTOs = entityMapper.toSeanceConflictDTOList(conflictPairs);
        CustomLogger.logInfo("SeanceConflictDTOs: ------------------" );
        seanceConflictDTOs.forEach(seanceConflictDTO -> {CustomLogger.logInfo( seanceConflictDTO + "\n" );} );

        // Fetch room conflicts
        List<Object[]> roomConflicts = seanceRepository.findConflictingByRooms(FrequenceType.BIWEEKLY,FrequenceType.CATCHUP);
        List<SeanceRoomConflictDTO> seanceRoomConflictDTOs = entityMapper.toSeanceRoomConflictDTOList(roomConflicts);
        CustomLogger.logInfo("SeanceRoomConflictDTOs: --------------------" );
        seanceRoomConflictDTOs.forEach(seanceRoomConflictDTO -> {CustomLogger.logInfo( seanceRoomConflictDTO + "\n" );} );

        // Fetch conflicts for a specific seance
        Long seanceId = seanceRepository.findAll().getFirst().getId();
        List<Object[]> conflictsForSeance = seanceRepository.findRoomConflictsForSeanceById(seanceId,FrequenceType.BIWEEKLY,FrequenceType.CATCHUP);
        List<SingleSeanceConflictDTO> singleSeanceConflictDTOs = entityMapper.toSingleSeanceConflictDTOList(conflictsForSeance);
        CustomLogger.logInfo("SingleSeanceConflictDTOs: ------------" );
        singleSeanceConflictDTOs.forEach(seanceConflictDTO -> {CustomLogger.logInfo( seanceConflictDTO + "\n" );} );
        CustomLogger.logInfo("===================FINISHED ---------------------------------");
    }
}package com.scheduling.universityschedule_backend.testingclasses;

import com.scheduling.universityschedule_backend.exception.CustomException;
import com.scheduling.universityschedule_backend.model.*;
import com.scheduling.universityschedule_backend.repository.*;
import com.scheduling.universityschedule_backend.util.CustomLogger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.time.*;
import java.util.*;
import java.util.stream.Collectors;

@Component
public class JPAtest {
    private static final List<String> NOMS = Arrays.asList(
            "Smith", "Johnson", "Williams", "Jones", "Brown", "Davis", "Miller",
            "Wilson", "Moore", "Taylor", "Anderson", "Thomas", "Jackson", "White"
    );

    private static final List<String> PRENOMS = Arrays.asList(
            "James", "Mary", "John", "Patricia", "Robert", "Jennifer", "Michael",
            "Linda", "William", "Elizabeth", "David", "Barbara", "Richard", "Susan"
    );

    private static final Random RANDOM = new Random();

    @Autowired private PersonneRepository personneRepository;
    @Autowired private EnseignantRepository enseignantRepository;
    @Autowired private AdministrateurRepository administrateurRepository;
    @Autowired private TechnicienRepository technicienRepository;
    @Autowired private EtudiantRepository etudiantRepository;
    @Autowired private BrancheRepository brancheRepository;
    @Autowired private SalleRepository salleRepository;
    @Autowired private SeanceRepository seanceRepository;
    @Autowired private TDRepository tdRepository;
    @Autowired private TPRepository tpRepository;
    @Autowired private NotificationRepository notificationRepository;
    @Autowired private SignalRepository signalRepository;
    @Autowired private PropositionDeRattrapageRepository propositionDeRattrapageRepository;
    @Autowired private FichierExcelRepository fichierExcelRepository;

    public void populateDatabase(int sampleSize) throws CustomException {
        CustomLogger.logInfo("=============================Populating Database====================");

        // 1. Administrateurs
        List<Administrateur> admins = new ArrayList<>();
        for (int i = 0; i < sampleSize % 3; i++) {
            Administrateur admin = new Administrateur();
            admin.setCin(generateRandomCin());
            admin.setNom(pickNom());
            admin.setPrenom(pickPrenom());
            admin.setEmail("admin" + i + "@example.com");
            admin.setTel(generateRandomTel());
            admin.setAdresse("Admin Address " + i);
            admin.setCodeAdmin("ADM" + i);
            admins.add(admin);
        }
        administrateurRepository.saveAll(admins);
        CustomLogger.logInfo("Administrateur count: " + admins.size());

        // 2. Enseignants
        List<Enseignant> enseignants = new ArrayList<>();
        for (int i = 0; i < sampleSize; i++) {
            Enseignant ens = new Enseignant();
            ens.setCin(generateRandomCin());
            ens.setNom(pickNom());
            ens.setPrenom(pickPrenom());
            ens.setEmail("enseignant" + i + "@example.com");
            ens.setTel(generateRandomTel());
            ens.setAdresse("Teacher Address " + i);
            ens.setCodeEnseignant("ENS" + i);
            ens.setHeures((int)(Math.random() * 40) + 1);
            enseignants.add(ens);
        }
        enseignantRepository.saveAll(enseignants);
        CustomLogger.logInfo("Enseignant count: " + enseignants.size());

        // 3. Techniciens
        List<Technicien> techniciens = new ArrayList<>();
        for (int i = 0; i < sampleSize % 3; i++) {
            Technicien tech = new Technicien();
            tech.setCin(generateRandomCin());
            tech.setNom(pickNom());
            tech.setPrenom(pickPrenom());
            tech.setEmail("tech" + i + "@example.com");
            tech.setTel(generateRandomTel());
            tech.setAdresse("Tech Address " + i);
            tech.setCodeTechnicien("TECH" + i);
            techniciens.add(tech);
        }
        technicienRepository.saveAll(techniciens);
        CustomLogger.logInfo("Technicien count: " + techniciens.size());

        // 4. Branches
        List<Branche> branches = new ArrayList<>();
        for (int i = 0; i < sampleSize / 15; i++) {
            Branche branche = new Branche();
            branche.setNiveau(pickNiveau());
            branche.setSpecialite(pickSpecialty(branche.getNiveau()));
            branche.setNbTD((int)(Math.random() * 5) + 1);
            branche.setDepartement(Math.random() < 0.33 ? "Technologie" : "informatique");
            branches.add(branche);
        }
        brancheRepository.saveAll(branches);
        CustomLogger.logInfo("Branche count: " + branches.size());

        // 5. Salles
        List<Salle> salles = new ArrayList<>();
        for (int i = 0; i < sampleSize / 10; i++) {
            Salle salle = new Salle();
            salle.setIdentifiant("SAL" + i);
            salle.setType("Lecture Hall");
            salle.setCapacite((int)(Math.random() * 150) + 50);
            salles.add(salle);
        }
        salleRepository.saveAll(salles);
        CustomLogger.logInfo("Salle count: " + salles.size());

        // 6. TDs
        List<TD> tds = new ArrayList<>();
        for (int i = 0; i < (sampleSize * 3) / 20; i++) {
            TD td = new TD();
            td.setNb((int)(Math.random() * 5) + 1);
            td.setNbTP((int)(Math.random() * 3) + 1);
            td.setBranche(branches.get((int)(Math.random() * branches.size())));
            tds.add(td);
        }
        tdRepository.saveAll(tds);
        CustomLogger.logInfo("TD count: " + tds.size());

        // 7. TPs
        List<TP> tps = new ArrayList<>();
        for (int i = 0; i < 6; i++) {
            TP tp = new TP();
            tp.setNb((int)(Math.random() * 3) + 1);
            tp.setTd(tds.get((int)(Math.random() * tds.size())));
            tps.add(tp);
            if (i > 2 && Math.random() < 0.5) break;
        }
        tpRepository.saveAll(tps);
        CustomLogger.logInfo("TP count: " + tps.size());

        // 8. Etudiants
        List<Etudiant> etudiants = new ArrayList<>();
        for (int i = 0; i < sampleSize * 3; i++) {
            Etudiant etu = new Etudiant();
            etu.setCin(generateRandomCin());
            etu.setNom(pickNom());
            etu.setPrenom(pickPrenom());
            etu.setEmail("etudiant" + i + "@example.com");
            etu.setTel(generateRandomTel());
            etu.setAdresse("Student Address " + i);
            etu.setMatricule("MAT" + i);
            etu.setBranche(branches.get((int)(Math.random() * branches.size())));
            etu.setTp(tps.get((int)(Math.random() * tps.size())));
            etudiants.add(etu);
        }
        etudiantRepository.saveAll(etudiants);
        CustomLogger.logInfo("Etudiant count: " + etudiants.size());

        // 9. Seances
        List<Seance> seances = new ArrayList<>();
        for (int i = 0; i < sampleSize * 2; i++) {
            Seance seance = new Seance();
            seance.setName("Seance " + i);
            seance.setMatiere(pickRandomSubject());
            seance.setJour(randomDay());
            seance.setHeureDebut(randomTime());
            seance.setHeureFin(randomTimeAfter(seance.getHeureDebut()));
            seance.setFrequence(randomFrequence());
            seance.setType(pickRandomSeanceType());
            seance.setDate(randomFrequence() == FrequenceType.CATCHUP ? LocalDate.now().plusDays(i) : null);
            seance.setSalle(salles.get((int)(Math.random() * salles.size())));
            seance.setEnseignant(enseignants.get((int)(Math.random() * enseignants.size())));
            seance.setBranches(List.of(branches.get((int)(Math.random() * branches.size()))));
            seance.setTds(List.of(tds.get((int)(Math.random() * tds.size()))));
            seance.setTps(List.of(tps.get((int)(Math.random() * tps.size()))));
            seances.add(seance);
        }
        seanceRepository.saveAll(seances);
        CustomLogger.logInfo("Seance count: " + seances.size());

        // 10. Signals
        List<Signal> signals = new ArrayList<>();
        for (int i = 0; i < Math.max(1, sampleSize / 3); i++) {
            Signal signal = new Signal();
            signal.setMessage("Signal Issue " + i);
            signal.setSeverity(Math.random() > 0.5 ? "High" : "Low");
            signal.setTimestamp(LocalDateTime.now().plusMinutes((int)(Math.random() * 1000)));
            signal.setEnseignant(enseignants.get((int)(Math.random() * enseignants.size())));
            signals.add(signal);
        }
        signalRepository.saveAll(signals);
        CustomLogger.logInfo("Signal count: " + signals.size());

        // 11. PropositionsDeRattrapage
        List<PropositionDeRattrapage> propositions = new ArrayList<>();
        for (int i = 0; i < Math.max(1, sampleSize / 3); i++) {
            PropositionDeRattrapage prop = new PropositionDeRattrapage();

            // Basic info
            prop.setName("Makeup Session " + i);
            prop.setMatiere(pickRandomSubject());
            prop.setType(pickRandomSeanceType());

            // Time settings
            LocalTime startTime = randomTime();
            prop.setHeureDebut(startTime);
            prop.setHeureFin(randomTimeAfter(startTime));
            prop.setDate(LocalDateTime.now().plusDays(RANDOM.nextInt(14))); // Next 2 weeks

            // Status and reason
            prop.setStatus(Status.PENDING); // New propositions always start as PENDING
            prop.setReason(pickRandomReason());

            // Relationships
            prop.setEnseignant(enseignants.get(RANDOM.nextInt(enseignants.size())));
            prop.setBranches(pickRandomBranches(branches, 1, 3));  // 1-3 branches
            prop.setTds(pickRandomTDs(tds, 1, 2));                 // 1-2 TDs
            prop.setTps(pickRandomTPs(tps, 0, 2));                 // 0-2 TPs

            propositions.add(prop);
        }
        propositionDeRattrapageRepository.saveAll(propositions);
        CustomLogger.logInfo("PropositionDeRattrapage count: " + propositions.size());

        // 12. Notifications
        List<Notification> notifications = new ArrayList<>();
        for (int i = 0; i < Math.max(1, sampleSize / 2); i++) {
            Notification notif = new Notification();
            notif.setMessage("Notification " + i);
            notif.setDate(LocalDateTime.now().plusMinutes((int)(Math.random() * 1000)));
            notif.setType("Update");
            notif.setIsread(false);
            notif.setRecepteur(enseignants.get((int)(Math.random() * enseignants.size())));
            notif.setExpediteur(admins.isEmpty() ? null : admins.get((int)(Math.random() * admins.size())));
            notifications.add(notif);
        }
        notificationRepository.saveAll(notifications);
        CustomLogger.logInfo("Notification count: " + notifications.size());

        // 13. FichiersExcel
        List<FichierExcel> fichiers = new ArrayList<>();
        for (int i = 0; i < Math.max(1, sampleSize / 5); i++) {
            FichierExcel fichier = new FichierExcel();
            fichier.setFileName("schedule_" + i + ".xlsx");
            fichier.setStatus("Imported");
            fichier.setErrors(List.of("No errors"));
            fichier.setImportDate(LocalDateTime.now());
            fichiers.add(fichier);
        }
        fichierExcelRepository.saveAll(fichiers);
        CustomLogger.logInfo("FichierExcel count: " + fichiers.size());

        CustomLogger.logInfo("Database populated with sampleSize = " + sampleSize);
        CustomLogger.logInfo("========================Finished populating database===========");
    }

    // Helper methods

    private SeanceType pickRandomSeanceType() {
        SeanceType[] types = SeanceType.values();
        return types[RANDOM.nextInt(types.length)];
    }

    private String pickRandomSubject() {
        String[] subjects = {
                "Mathematics", "Physics", "Chemistry",
                "Computer Architecture", "Database Systems", "Operating Systems",
                "Data Structures", "Algorithms", "Software Engineering",
                "Networks", "Artificial Intelligence", "Web Development",
                "Mobile Development", "Cloud Computing", "Security",
                "Statistics", "Linear Algebra", "Calculus"
        };
        return subjects[RANDOM.nextInt(subjects.length)];
    }

    private Status pickRandomStatus() {
        Status[] statuses = Status.values();
        return statuses[RANDOM.nextInt(statuses.length)];
    }

    private String pickRandomReason() {
        String[] reasons = {
                "Previous session cancelled due to emergency",
                "Holiday makeup session",
                "Extra practice needed before exam",
                "Schedule conflict resolution",
                "Weather-related cancellation makeup",
                "Technical issues in previous session",
                "Extended topic coverage needed",
                "Preparatory session for upcoming exam",
                "Missed class coverage",
                "Student request for additional practice"
        };
        return reasons[RANDOM.nextInt(reasons.length)];
    }

    private List<Branche> pickRandomBranches(List<Branche> branches, int min, int max) {
        int count = min + RANDOM.nextInt(max - min + 1);
        List<Branche> selected = new ArrayList<>();
        for (int i = 0; i < count && i < branches.size(); i++) {
            selected.add(branches.get(RANDOM.nextInt(branches.size())));
        }
        return new ArrayList<>(new HashSet<>(selected)); // Remove duplicates
    }

    private List<TD> pickRandomTDs(List<TD> tds, int min, int max) {
        int count = min + RANDOM.nextInt(max - min + 1);
        List<TD> selected = new ArrayList<>();
        for (int i = 0; i < count && i < tds.size(); i++) {
            selected.add(tds.get(RANDOM.nextInt(tds.size())));
        }
        return new ArrayList<>(new HashSet<>(selected)); // Remove duplicates
    }

    private List<TP> pickRandomTPs(List<TP> tps, int min, int max) {
        int count = min + RANDOM.nextInt(max - min + 1);
        List<TP> selected = new ArrayList<>();
        for (int i = 0; i < count && i < tps.size(); i++) {
            selected.add(tps.get(RANDOM.nextInt(tps.size())));
        }
        return new ArrayList<>(new HashSet<>(selected)); // Remove duplicates
    }
    private DayOfWeek randomDay() {
        return DayOfWeek.values()[RANDOM.nextInt(5)];
    }

    private LocalTime randomTime() {
        return LocalTime.of(8 + RANDOM.nextInt(9), RANDOM.nextInt(12) * 5);
    }

    private LocalTime randomTimeAfter(LocalTime start) {
        return start.plusMinutes(90 + RANDOM.nextInt(90));
    }

    private FrequenceType randomFrequence() {
        FrequenceType[] freqs = FrequenceType.values();
        return freqs[RANDOM.nextInt(freqs.length)];
    }

    private String generateRandomCin() {
        return String.valueOf(100000000 + RANDOM.nextInt(900000000));
    }

    private String generateRandomTel() {
        return String.valueOf(1000000000L + RANDOM.nextLong(9000000000L));
    }

    private static String pickNom() {
        return NOMS.get(RANDOM.nextInt(NOMS.size()));
    }

    private static String pickPrenom() {
        return PRENOMS.get(RANDOM.nextInt(PRENOMS.size()));
    }

    private static String pickNiveau() {
        String[] systems = {"L", "CPI", "ING", "MR", "MP"};
        String system = systems[RANDOM.nextInt(systems.length)];
        int yearLevel = switch (system) {
            case "L" -> RANDOM.nextInt(3) + 1;
            case "CPI" -> RANDOM.nextInt(2) + 1;
            case "ING" -> RANDOM.nextInt(3) + 1;
            default -> RANDOM.nextInt(2) + 1;
        };
        return system + yearLevel;
    }

    private static String pickSpecialty(String niveau) {
        if (niveau.startsWith("L")) return Arrays.asList("EEA", "INFO", "TIC", "MATH").get(RANDOM.nextInt(4));
        if (niveau.startsWith("CPI")) return "INFO";
        if (niveau.startsWith("ING")) return Arrays.asList("ELEC", "INFO").get(RANDOM.nextInt(2));
        return Arrays.asList("GL", "I3", "DS").get(RANDOM.nextInt(3));
    }

    @Transactional
    public void testRetrieveEntities() {
        CustomLogger.logInfo("============================= Retrieving Entity Samples =====================");

        // 1. Administrateurs
        List<Administrateur> admins = administrateurRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("----- Administrateurs (" + admins.size() + ") -----");
        admins.forEach(admin -> CustomLogger.logInfo(
                "Code: " + admin.getCodeAdmin() +
                        " | Name: " + admin.getNom() + " " + admin.getPrenom() +
                        " | Email: " + admin.getEmail() +
                        " | CIN: " + admin.getCin()
        ));

        // 2. Enseignants
        List<Enseignant> teachers = enseignantRepository.findAll().stream().limit(3).toList();
        CustomLogger.logInfo("\n----- Enseignants (" + teachers.size() + ") -----");
        teachers.forEach(teacher -> CustomLogger.logInfo(
                "Code: " + teacher.getCodeEnseignant() +
                        " | Hours: " + teacher.getHeures() +
                        " | Tel: " + teacher.getTel() +
                        " | Seances: " + (teacher.getSeances() != null ? teacher.getSeances().size() : 0)
        ));

        // 3. Techniciens
        List<Technicien> techs = technicienRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- Techniciens (" + techs.size() + ") -----");
        techs.forEach(tech -> CustomLogger.logInfo(
                "Code: " + tech.getCodeTechnicien() +
                        " | Address: " + tech.getAdresse() +
                        " | Email: " + tech.getEmail()
        ));

        // 4. Etudiants
        List<Etudiant> students = etudiantRepository.findAll().stream().limit(3).toList();
        CustomLogger.logInfo("\n----- Etudiants (" + students.size() + ") -----");
        students.forEach(student -> CustomLogger.logInfo(
                "Matricule: " + student.getMatricule() +
                        " | Branch: " + (student.getBranche() != null ? student.getBranche().getSpecialite() : "N/A") +
                        " | TP Group: " + (student.getTp() != null ? student.getTp().getId() : "N/A")
        ));

        // 5. Branches
        List<Branche> branches = brancheRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- Branches (" + branches.size() + ") -----");
        branches.forEach(branch -> CustomLogger.logInfo(
                "Level: " + branch.getNiveau() +
                        " | Specialty: " + branch.getSpecialite() +
                        " | TDs: " + branch.getNbTD() +
                        " | Department: " + branch.getDepartement()
        ));

        // 6. Salles
        List<Salle> rooms = salleRepository.findAll().stream().limit(3).toList();
        CustomLogger.logInfo("\n----- Salles (" + rooms.size() + ") -----");
        rooms.forEach(room -> CustomLogger.logInfo(
                "ID: " + room.getIdentifiant() +
                        " | Type: " + room.getType() +
                        " | Capacity: " + room.getCapacite() +
                        " | Seances: " + (room.getSeances() != null ? room.getSeances().size() : 0)
        ));

        // 7. Seances
        List<Seance> sessions = seanceRepository.findAll().stream().limit(3).toList();
        CustomLogger.logInfo("\n----- Seances (" + sessions.size() + ") -----");
        sessions.forEach(session -> CustomLogger.logInfo(
                "Subject: " + session.getMatiere() +
                        " | Day: " + session.getJour() +
                        " | Time: " + session.getHeureDebut() + "-" + session.getHeureFin() +
                        " | Type: " + session.getFrequence()
        ));

        // 8. TDs
        List<TD> tds = tdRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- TDs (" + tds.size() + ") -----");
        tds.forEach(td -> CustomLogger.logInfo(
                "ID: " + td.getId() +
                        " | Group: " + td.getNb() +
                        " | TPs: " + td.getNbTP() +
                        " | Branch: " + (td.getBranche() != null ? td.getBranche().getNiveau() : "N/A")
        ));

        // 9. TPs
        List<TP> tps = tpRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- TPs (" + tps.size() + ") -----");
        tps.forEach(tp -> CustomLogger.logInfo(
                "ID: " + tp.getId() +
                        " | Group: " + tp.getNb() +
                        " | TD: " + (tp.getTd() != null ? tp.getTd().getId() : "N/A") +
                        " | Students: " + (tp.getEtudiants() != null ? tp.getEtudiants().size() : 0)
        ));

        // 10. Signals
        List<Signal> signals = signalRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- Signals (" + signals.size() + ") -----");
        signals.forEach(signal -> CustomLogger.logInfo(
                "ID: " + signal.getId() +
                        " | Severity: " + signal.getSeverity() +
                        " | Date: " + signal.getTimestamp() +
                        " | Teacher: " + (signal.getEnseignant() != null ? signal.getEnseignant().getCodeEnseignant() : "N/A")
        ));

        // 11. Propositions
        List<PropositionDeRattrapage> propositions = propositionDeRattrapageRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- Propositions (" + propositions.size() + ") -----");
        propositions.forEach(prop -> CustomLogger.logInfo(
                "ID: " + prop.getId() +
                        " | Date: " + prop.getDate() +
                        " | Status: " + prop.getStatus() +
                        " | Teacher: " + (prop.getEnseignant() != null ? prop.getEnseignant().getCodeEnseignant() : "N/A")
        ));

        // 12. Notifications
        List<Notification> notifications = notificationRepository.findAll().stream().limit(3).toList();
        CustomLogger.logInfo("\n----- Notifications (" + notifications.size() + ") -----");
        notifications.forEach(notif -> CustomLogger.logInfo(
                "ID: " + notif.getId() +
                        " | Type: " + notif.getType() +
                        " | Read: " + notif.isRead() +
                        " | Sender: " + (notif.getExpediteur() != null ? notif.getExpediteur().getCin() : "System") +
                        " | Receiver: " + (notif.getRecepteur() != null ? notif.getRecepteur().getNom() : "N/A")
        ));

        // 13. Fichiers
        List<FichierExcel> fichiers = fichierExcelRepository.findAll().stream().limit(2).toList();
        CustomLogger.logInfo("\n----- Fichiers (" + fichiers.size() + ") -----");
        fichiers.forEach(fichier -> CustomLogger.logInfo(
                "ID: " + fichier.getId() +
                        " | File: " + fichier.getFileName() +
                        " | Status: " + fichier.getStatus() +
                        " | Errors: " + String.join(", ", fichier.getErrors())
        ));

        CustomLogger.logInfo("============================= Retrieval Complete =====================");
    }


    @Transactional
    public void testRetrieveAndDelete() {
        CustomLogger.logInfo("=============================Deleting Sample Data====================");

        // Delete notifications
        List<Notification> notifications = notificationRepository.findAll().stream().limit(2).toList();
        notificationRepository.deleteAll(notifications);
        CustomLogger.logInfo("Deleted " + notifications.size() + " notifications");

        // Delete signals
        List<Signal> signals = signalRepository.findAll().stream().limit(2).toList();
        signalRepository.deleteAll(signals);
        CustomLogger.logInfo("Deleted " + signals.size() + " signals");

        // Delete fichiers
        List<FichierExcel> fichiers = fichierExcelRepository.findAll().stream().limit(1).toList();
        fichierExcelRepository.deleteAll(fichiers);
        CustomLogger.logInfo("Deleted " + fichiers.size() + " fichiers");
    }

    @Transactional
    public void testRetrieveAndModify() {
        CustomLogger.logInfo("==================== Modifying Sample Entities ====================");

        // 1. Modify Enseignants
        enseignantRepository.findAll().stream().limit(2).forEach(enseignant -> {
            CustomLogger.logInfo("\n----- Original Enseignant -----");
            CustomLogger.logInfo("Code: " + enseignant.getCodeEnseignant());
            CustomLogger.logInfo("Hours: " + enseignant.getHeures());
            CustomLogger.logInfo("Email: " + enseignant.getEmail());

            int newHours = enseignant.getHeures() + 5;
            enseignant.setHeures(newHours);
            enseignantRepository.save(enseignant);

            CustomLogger.logInfo("----- Modified Enseignant -----");
            CustomLogger.logInfo("New hours: " + enseignant.getHeures());
        });

        // 2. Modify Etudiants
        etudiantRepository.findAll().stream().limit(2).forEach(etudiant -> {
            CustomLogger.logInfo("\n----- Original Etudiant -----");
            CustomLogger.logInfo("Matricule: " + etudiant.getMatricule());
            CustomLogger.logInfo("Address: " + etudiant.getAdresse());

            String newAddress = "Updated Address " + LocalDateTime.now().getMinute();
            etudiant.setAdresse(newAddress);
            etudiantRepository.save(etudiant);

            CustomLogger.logInfo("----- Modified Etudiant -----");
            CustomLogger.logInfo("New address: " + etudiant.getAdresse());
        });

        // 3. Modify Seances
        seanceRepository.findAll().stream().limit(2).forEach(seance -> {
            CustomLogger.logInfo("\n----- Original Seance -----");
            CustomLogger.logInfo("Matiere: " + seance.getMatiere());
            CustomLogger.logInfo("Time: " + seance.getHeureDebut() + "-" + seance.getHeureFin());
            CustomLogger.logInfo("Salle: " + (seance.getSalle() != null ? seance.getSalle().getIdentifiant() : "None"));

            // Modify time
            LocalTime newStart = seance.getHeureDebut().plusMinutes(30);
            LocalTime newEnd = seance.getHeureFin().plusMinutes(30);
            seance.setHeureDebut(newStart);
            seance.setHeureFin(newEnd);
            seanceRepository.save(seance);

            CustomLogger.logInfo("----- Modified Seance -----");
            CustomLogger.logInfo("New time: " + seance.getHeureDebut() + "-" + seance.getHeureFin());
        });

        // 4. Modify Salles
        salleRepository.findAll().stream().limit(2).forEach(salle -> {
            CustomLogger.logInfo("\n----- Original Salle -----");
            CustomLogger.logInfo("ID: " + salle.getIdentifiant());
            CustomLogger.logInfo("Type: " + salle.getType());
            CustomLogger.logInfo("Capacity: " + salle.getCapacite());

            // Modify properties
            salle.setType("Modified Type");
            salle.setCapacite(salle.getCapacite() + 10);
            salleRepository.save(salle);

            CustomLogger.logInfo("----- Modified Salle -----");
            CustomLogger.logInfo("New type: " + salle.getType());
            CustomLogger.logInfo("New capacity: " + salle.getCapacite());
        });

        CustomLogger.logInfo("==================== Modification Complete ====================");
    }
    @Transactional
    public void testListFetch() {
        CustomLogger.logInfo("==================== Testing List Fetching ====================");

        // 1. Enseignant (Seances, Propositions, Signals)
        enseignantRepository.findAll().stream().limit(2).forEach(enseignant -> {
            CustomLogger.logInfo("\n----- Enseignant " + enseignant.getCodeEnseignant() + " -----");

            // Seances
            CustomLogger.logInfo("Seances (" + enseignant.getSeances().size() + "):");
            enseignant.getSeances().stream().limit(3).forEach(seance ->
                    CustomLogger.logInfo("- " + seance.getMatiere() + " | " +
                            seance.getHeureDebut() + "-" + seance.getHeureFin())
            );

            // Propositions
            CustomLogger.logInfo("Propositions (" + enseignant.getPropositionsDeRattrapage().size() + "):");
            enseignant.getPropositionsDeRattrapage().stream().limit(3).forEach(prop ->
                    CustomLogger.logInfo("- " + prop.getReason() + " | " + prop.getStatus())
            );

            // Signals
            CustomLogger.logInfo("Signals (" + enseignant.getSignals().size() + "):");
            enseignant.getSignals().stream().limit(3).forEach(signal ->
                    CustomLogger.logInfo("- " + signal.getMessage() + " | " + signal.getSeverity())
            );
        });

        // 2. Branche (Seances)
        brancheRepository.findAll().stream().limit(2).forEach(branche -> {
            CustomLogger.logInfo("\n----- Branche " + branche.getSpecialite() + " -----");

            CustomLogger.logInfo("Seances (" + branche.getSeances().size() + "):");
            branche.getSeances().stream().limit(3).forEach(seance ->
                    CustomLogger.logInfo("- "+ seance.getJour() +"- " + seance.getMatiere() + " | " +
                            seance.getHeureDebut() + "-" + seance.getHeureFin())
            );
        });

        // 3. Seance (Branches, TDs, TPs)
        seanceRepository.findAll().stream().limit(2).forEach(seance -> {
            CustomLogger.logInfo("\n----- Seance " + seance.getMatiere() + " -----");

            // Branches
            CustomLogger.logInfo("Branches (" + seance.getBranches().size() + "):");
            seance.getBranches().stream().limit(3).forEach(branche ->
                    CustomLogger.logInfo("- " + branche.getNiveau() + " " + branche.getSpecialite())
            );

            // TDs
            CustomLogger.logInfo("TDs (" + seance.getTds().size() + "):");
            seance.getTds().stream().limit(3).forEach(td ->
                    CustomLogger.logInfo("- TD" + td.getNb() + " | " + td.getBranche().getSpecialite())
            );

            // TPs
            CustomLogger.logInfo("TPs (" + seance.getTps().size() + "):");
            seance.getTps().stream().limit(3).forEach(tp ->
                    CustomLogger.logInfo("- TP" + tp.getNb() + " | " + tp.getTd().getNb())
            );
        });

        // 4. Salle (Seances)
        salleRepository.findAll().stream().limit(2).forEach(salle -> {
            CustomLogger.logInfo("\n----- Salle " + salle.getIdentifiant() + " -----");

            CustomLogger.logInfo("Seances (" + salle.getSeances().size() + "):");
            salle.getSeances().stream().limit(3).forEach(seance ->
                    CustomLogger.logInfo("- " + seance.getMatiere() + " | " +
                            seance.getHeureDebut() + "-" + seance.getHeureFin())
            );
        });

        // 5. TD (TPs, Seances)
        tdRepository.findAll().stream().limit(2).forEach(td -> {
            CustomLogger.logInfo("\n----- TD " + td.getNb() + " -----");

            // TPs
            CustomLogger.logInfo("TPs (" + td.getTpList().size() + "):");
            td.getTpList().stream().limit(3).forEach(tp ->
                    CustomLogger.logInfo("- TP" + tp.getNb() + " | Students: " + tp.getEtudiants().size())
            );

            // Seances
            CustomLogger.logInfo("Seances (" + td.getSeances().size() + "):");
            td.getSeances().stream().limit(3).forEach(seance ->
                    CustomLogger.logInfo("- " + seance.getMatiere() + " | " +
                            seance.getHeureDebut() + "-" + seance.getHeureFin())
            );
        });

        // 6. TP (Etudiants, Seances)
        tpRepository.findAll().stream().limit(2).forEach(tp -> {
            CustomLogger.logInfo("\n----- TP " + tp.getNb() + " -----");

            // Etudiants
            CustomLogger.logInfo("Etudiants (" + tp.getEtudiants().size() + "):");
            tp.getEtudiants().stream().limit(3).forEach(etudiant ->
                    CustomLogger.logInfo("- " + etudiant.getMatricule() + " | " +
                            etudiant.getNom() + " " + etudiant.getPrenom())
            );

            // Seances
            CustomLogger.logInfo("Seances (" + tp.getSeances().size() + "):");
            tp.getSeances().stream().limit(3).forEach(seance ->
                    CustomLogger.logInfo("- " + seance.getMatiere() + " | " +
                            seance.getHeureDebut() + "-" + seance.getHeureFin())
            );
        });

        // 7. FichierExcel (Errors)
        fichierExcelRepository.findAll().stream().limit(2).forEach(fichier -> {
            CustomLogger.logInfo("\n----- Fichier " + fichier.getFileName() + " -----");

            CustomLogger.logInfo("Errors (" + fichier.getErrors().size() + "):");
            fichier.getErrors().forEach(error ->
                    CustomLogger.logInfo("- " + error)
            );
        });

        CustomLogger.logInfo("==================== List Fetching Complete ====================");
    }

}package com.scheduling.universityschedule_backend.testingclasses;

import com.scheduling.universityschedule_backend.dto.*;
import com.scheduling.universityschedule_backend.exception.CustomException;
import com.scheduling.universityschedule_backend.model.FrequenceType;
import com.scheduling.universityschedule_backend.model.Status;
import com.scheduling.universityschedule_backend.model.SeanceType;
import com.scheduling.universityschedule_backend.service.*;
import com.scheduling.universityschedule_backend.util.CustomLogger;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.time.*;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;

@Component
@Transactional
public class ServiceTest {

    private final AdministrateurService administrateurService;
    private final BrancheService brancheService;
    private final EtudiantService etudiantService;
    private final ExcelFileService excelFileService;
    private final SalleService salleService;
    private final SeanceService seanceService;
    private final EnseignantService enseignantService;
    private final TDService tdService;
    private final TPService tpService;

    public ServiceTest(AdministrateurService administrateurService, BrancheService brancheService, EtudiantService etudiantService, ExcelFileService excelFileService, SalleService salleService, SeanceService seanceService, EnseignantService enseignantService, TDService tdService, TPService tpService) {
        this.administrateurService = administrateurService;
        this.brancheService = brancheService;
        this.etudiantService = etudiantService;
        this.excelFileService = excelFileService;
        this.salleService = salleService;
        this.seanceService = seanceService;
        this.enseignantService = enseignantService;
        this.tdService = tdService;
        this.tpService = tpService;
    }

    public void testAllServices() throws CustomException {
        //testAdministrateurService();
        testBrancheService();
        testEtudiantService();
        testExcelFileService();
        testSalleService();
        testSeanceService();
        testEnseignantService();
        testTDService();
        testTPService();
    }

    public void testAdministrateurService() throws CustomException {
        CustomLogger.logInfo("=================== Testing AdministrateurService ===================");

        try {
            // Test approve makeup session
            Long testPropositionId = 1L; // Assuming this exists
            Long testSalleId = 1L; // Assuming this exists
            Long testrejectid=15L;
            Long testrejectid2=16L;

            PropositionDeRattrapageDTO approvedProposition =
                    administrateurService.approveMakeupSession(testPropositionId, testSalleId);
            CustomLogger.logInfo("Approved Proposition: " + approvedProposition);

            // Test reject makeup session
            PropositionDeRattrapageDTO rejectedProposition =
                    administrateurService.rejectMakeupSession(testrejectid);
            CustomLogger.logInfo("Rejected Proposition: " + rejectedProposition);

            // Test approve scheduled
            PropositionDeRattrapageDTO approvedScheduled =
                    administrateurService.approveScheduled(18L, testSalleId);
            CustomLogger.logInfo("Approved Scheduled: " + approvedScheduled);

            // Test reject scheduled
            PropositionDeRattrapageDTO rejectedScheduled =
                    administrateurService.rejectScheduled(testrejectid2, "Room not available");
            CustomLogger.logInfo("Rejected Scheduled: " + rejectedScheduled);

        } catch (CustomException e) {
            CustomLogger.logError("AdministrateurService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testBrancheService() throws CustomException {
        CustomLogger.logInfo("=================== Testing BrancheService ===================");

        try {
            // Test findAll
            List<BrancheDTO> allBranches = brancheService.findAll();
            CustomLogger.logInfo("All Branches: " + allBranches.size());

            if (!allBranches.isEmpty()) {
                Long testBranchId = allBranches.getFirst().getId();

                // Test findById
                BrancheDTO branch = brancheService.findById(testBranchId);
                CustomLogger.logInfo("Found Branch: " + branch);

                // Test create
                BrancheDTO newBranch = new BrancheDTO();
                newBranch.setNiveau("L3");
                newBranch.setSpecialite("INFO");
                newBranch.setDepartement("Informatique");
                newBranch.setNbTD(3);
                BrancheDTO createdBranch = brancheService.create(newBranch);
                CustomLogger.logInfo("Created Branch: " + createdBranch);

                // Test update
                createdBranch.setNbTD(4);
                BrancheDTO updatedBranch = brancheService.update(createdBranch.getId(), createdBranch);
                CustomLogger.logInfo("Updated Branch: " + updatedBranch);

                // Test getSchedule
                List<SeanceDTO> schedule = brancheService.getSchedule(testBranchId);
                CustomLogger.logInfo("Branch Schedule: " + schedule.size() + " sessions");

                // Test getEtudiants
                List<EtudiantDTO> students = brancheService.getEtudiants(testBranchId);
                CustomLogger.logInfo("Branch Students: " + students.size() + " students");

                // Test delete
                brancheService.delete(createdBranch.getId());
                CustomLogger.logInfo("Deleted Branch with ID: " + createdBranch.getId());
            }
        } catch (CustomException e) {
            CustomLogger.logError("BrancheService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testEtudiantService() throws CustomException {
        CustomLogger.logInfo("=================== Testing EtudiantService ===================");

        try {
            // Test findAll
            List<EtudiantDTO> allStudents = etudiantService.findAll();
            CustomLogger.logInfo("All Students: " + allStudents.size());

            if (!allStudents.isEmpty()) {
                Long testStudentId = allStudents.getFirst().getId();

                // Test findById
                EtudiantDTO student = etudiantService.findById(testStudentId);
                CustomLogger.logInfo("Found Student: " + student);

                // Test create
                EtudiantDTO newStudent = new EtudiantDTO();
                newStudent.setNom("Test");
                newStudent.setPrenom("Student");
                newStudent.setEmail("test.student@example.com");
                newStudent.setMatricule("TEST123");
                EtudiantDTO createdStudent = etudiantService.create(newStudent);
                CustomLogger.logInfo("Created Student: " + createdStudent);

                // Test update
                createdStudent.setEmail("updated.test@example.com");
                EtudiantDTO updatedStudent = etudiantService.update(createdStudent.getId(), createdStudent);
                CustomLogger.logInfo("Updated Student: " + updatedStudent);

                // Test getPersonalSchedule
                List<SeanceDTO> personalSchedule = etudiantService.getPersonalSchedule(testStudentId);
                CustomLogger.logInfo("Personal Schedule: " + personalSchedule.size() + " sessions");

                // Test getBranchSchedule
                List<SeanceDTO> branchSchedule = etudiantService.getBranchSchedule(testStudentId);
                CustomLogger.logInfo("Branch Schedule: " + branchSchedule.size() + " sessions");

                // Test getTDSchedule
                List<SeanceDTO> tdSchedule = etudiantService.getTDSchedule(testStudentId);
                CustomLogger.logInfo("TD Schedule: " + tdSchedule.size() + " sessions");

                // Test getNotifications
                List<NotificationDTO> notifications = etudiantService.getNotifications(testStudentId);
                CustomLogger.logInfo("Notifications: " + notifications.size() + " notifications");

                // Test delete
                etudiantService.delete(createdStudent.getId());
                CustomLogger.logInfo("Deleted Student with ID: " + createdStudent.getId());
            }
        } catch (CustomException e) {
            CustomLogger.logError("EtudiantService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testExcelFileService() throws CustomException {
        CustomLogger.logInfo("=================== Testing ExcelFileService ===================");

        try {
            // Test findAll
            List<FichierExcelDTO> allFiles = excelFileService.findAll();
            CustomLogger.logInfo("All Files: " + allFiles.size());

            // Test create
            FichierExcelDTO newFile = new FichierExcelDTO();
            newFile.setFileName("test_file.xlsx");
            newFile.setStatus("Processing");
            newFile.setImportDate(LocalDateTime.now());
            newFile.setErrors(List.of("No errors"));
            FichierExcelDTO createdFile = excelFileService.create(newFile);
            CustomLogger.logInfo("Created File: " + createdFile);

            // Test findById
            FichierExcelDTO foundFile = excelFileService.findById(createdFile.getId());
            CustomLogger.logInfo("Found File: " + foundFile);

            // Test update
            createdFile.setStatus("Completed");
            FichierExcelDTO updatedFile = excelFileService.update(createdFile.getId(), createdFile);
            CustomLogger.logInfo("Updated File: " + updatedFile);

            // Test upload
            List<SeanceDTO> seances = new ArrayList<>(); // Add some test seances
            excelFileService.upload(createdFile, seances);
            CustomLogger.logInfo("Uploaded File with sessions");

            // Test getImportHistory
            List<FichierExcelDTO> history = excelFileService.getImportHistory();
            CustomLogger.logInfo("Import History: " + history.size() + " files");

            // Test delete
            excelFileService.delete(createdFile.getId());
            CustomLogger.logInfo("Deleted File with ID: " + createdFile.getId());

        } catch (CustomException e) {
            CustomLogger.logError("ExcelFileService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testSalleService() throws CustomException {
        CustomLogger.logInfo("=================== Testing SalleService ===================");

        try {
            // Test findAll
            List<SalleDTO> allRooms = salleService.findAll();
            CustomLogger.logInfo("All Rooms: " + allRooms.size());

            // Test create
            SalleDTO newRoom = new SalleDTO();
            newRoom.setIdentifiant("TEST-ROOM");
            newRoom.setType("Classroom");
            newRoom.setCapacite(30);
            SalleDTO createdRoom = salleService.create(newRoom);
            CustomLogger.logInfo("Created Room: " + createdRoom);

            // Test findById
            SalleDTO foundRoom = salleService.findById(createdRoom.getId());
            CustomLogger.logInfo("Found Room: " + foundRoom);

            // Test update
            createdRoom.setCapacite(40);
            SalleDTO updatedRoom = salleService.update(createdRoom.getId(), createdRoom);
            CustomLogger.logInfo("Updated Room: " + updatedRoom);

            // Test getAvailableRooms
            List<SalleDTO> availableRooms = salleService.getAvailableRooms(
                    LocalDate.now(),
                    DayOfWeek.MONDAY,
                    LocalTime.of(9, 0),
                    LocalTime.of(10, 30)
            );
            CustomLogger.logInfo("Available Rooms: " + availableRooms.size());

            // Test delete
            salleService.delete(createdRoom.getId());
            CustomLogger.logInfo("Deleted Room with ID: " + createdRoom.getId());

        } catch (CustomException e) {
            CustomLogger.logError("SalleService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testSeanceService() throws CustomException {
        CustomLogger.logInfo("=================== Testing SeanceService ===================");

        try {
            // Test findAll
            List<SeanceDTO> allSessions = seanceService.findAll();
            CustomLogger.logInfo("All Sessions: " + allSessions.size());

            // Test create
            SeanceDTO newSession = new SeanceDTO();
            newSession.setMatiere("Test Subject");
            newSession.setType(String.valueOf(SeanceType.CR));
            newSession.setJour(String.valueOf(DayOfWeek.MONDAY));
            newSession.setHeureDebut(String.valueOf(LocalTime.of(9, 0)));
            newSession.setHeureFin(String.valueOf(LocalTime.of(10, 30)));
            newSession.setEnseignantId(11L);
            newSession.setFrequence(String.valueOf(FrequenceType.WEEKLY));
            SeanceDTO createdSession = seanceService.create(newSession);
            SeanceDTO createdSession2 = seanceService.create(newSession);
            CustomLogger.logInfo("Created Session: " + createdSession);

            // Test findById
            SeanceDTO foundSession = seanceService.findById(createdSession.getId());
            CustomLogger.logInfo("Found Session: " + foundSession);

            // Test update
            SeanceDTO updatedSession = seanceService.update(createdSession.getId(), createdSession);
            CustomLogger.logInfo("Updated Session: " + updatedSession);

            // Test getAllConflicts
            List<SeanceConflictDTO> conflicts = seanceService.getAllConflicts();
            CustomLogger.logInfo("All Conflicts: " + conflicts.size());
            List<SeanceConflictDTO> setofConflicts = conflicts.stream().limit(3).toList();

            for (SeanceConflictDTO seanceConflict : setofConflicts) {
                CustomLogger.logInfo("Found Conflict: " + seanceConflict);
            }
            Long conflictId = setofConflicts.getFirst().getSeance1Id();

            // Test getRoomConflicts
            List<SeanceRoomConflictDTO> roomConflicts = seanceService.getRoomConflicts();
            CustomLogger.logInfo("Room Conflicts: " + roomConflicts.size());

            // Test getConflictsForSession (by ID)
            List<SingleSeanceConflictDTO> sessionConflicts =
                    seanceService.getConflictsForSession(conflictId);
            CustomLogger.logInfo("Session Conflicts: " + sessionConflicts.size());
            CustomLogger.logInfo("to search "+seanceService.findById(conflictId));
            // Test getConflictsForSession (by DTO)
            List<SingleSeanceConflictDTO> dtoConflicts =
                    seanceService.getConflictsForSession(seanceService.findById(conflictId));
            CustomLogger.logInfo("DTO Conflicts: " + dtoConflicts.size());

            // Test delete
            seanceService.delete(createdSession.getId());
            CustomLogger.logInfo("Deleted Session with ID: " + createdSession.getId());

        } catch (CustomException e) {
            CustomLogger.logError("SeanceService test failed: " + e.getMessage());
            throw e;
        }
    }
    // Add these test methods to your ServiceTest class

    public void testEnseignantService() throws CustomException {
        CustomLogger.logInfo("=================== Testing EnseignantService ===================");

        try {
            // Test findAll
            List<EnseignantDTO> allTeachers = enseignantService.findAll();
            CustomLogger.logInfo("All Teachers: " + allTeachers.size());

            // Test create
            EnseignantDTO newTeacher = new EnseignantDTO();
            newTeacher.setNom("Test");
            newTeacher.setPrenom("Teacher");
            newTeacher.setEmail("test.teacher@example.com");
            newTeacher.setCodeEnseignant("TEACH123");
            newTeacher.setHeures(20);
            EnseignantDTO createdTeacher = enseignantService.create(newTeacher);
            CustomLogger.logInfo("Created Teacher: " + createdTeacher);

            // Test findById
            EnseignantDTO foundTeacher = enseignantService.findById(createdTeacher.getId());
            CustomLogger.logInfo("Found Teacher: " + foundTeacher);

            // Test update
            createdTeacher.setHeures(25);
            EnseignantDTO updatedTeacher = enseignantService.update(createdTeacher.getId(), createdTeacher);
            CustomLogger.logInfo("Updated Teacher: " + updatedTeacher);

            // Test getSchedule
            List<SeanceDTO> schedule = enseignantService.getSchedule(createdTeacher.getId());
            CustomLogger.logInfo("Teacher Schedule: " + schedule.size() + " sessions");

            // Test getTotalTeachingHours
            int hours = enseignantService.getTotalTeachingHours(
                    createdTeacher.getId(),
                    LocalDate.now(),
                    LocalDate.now().plusMonths(1)
            );
            CustomLogger.logInfo("Total Teaching Hours: " + hours);

            // Test submitMakeupRequest
            PropositionDeRattrapageDTO proposition = new PropositionDeRattrapageDTO();
            proposition.setName("Makeup Test");
            proposition.setMatiere("Test Subject");
            proposition.setType(String.valueOf(SeanceType.CI));
            proposition.setDate(String.valueOf(LocalDateTime.now().plusDays(7)));
            PropositionDeRattrapageDTO submittedProposition =
                    enseignantService.submitMakeupRequest(createdTeacher.getId(), proposition);
            CustomLogger.logInfo("Submitted Makeup Request: " + submittedProposition);

            // Test submitSignal
            SignalDTO signal = new SignalDTO();
            signal.setMessage("Test Signal");
            signal.setSeverity("Low");
            SignalDTO submittedSignal = enseignantService.submitSignal(createdTeacher.getId(), signal);
            CustomLogger.logInfo("Submitted Signal: " + submittedSignal);

            // Test getSignals
            List<SignalDTO> signals = enseignantService.getSignals(createdTeacher.getId());
            CustomLogger.logInfo("Teacher Signals: " + signals.size());

            // Test getSubjects
            List<String> subjects = enseignantService.getSubjects(createdTeacher.getId());
            CustomLogger.logInfo("Teacher Subjects: " + subjects.size());

            // Test getStudentGroups
            List<TPDTO> groups = enseignantService.getStudentGroups(createdTeacher.getId());
            CustomLogger.logInfo("Teacher Student Groups: " + groups.size());

            // Test delete
            enseignantService.delete(createdTeacher.getId());
            CustomLogger.logInfo("Deleted Teacher with ID: " + createdTeacher.getId());

        } catch (CustomException e) {
            CustomLogger.logError("EnseignantService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testTDService() throws CustomException {
        CustomLogger.logInfo("=================== Testing TDService ===================");

        try {
            // Test findAll
            List<TDDTO> allTDs = tdService.findAll();
            CustomLogger.logInfo("All TDs: " + allTDs.size());

            // Test create
            TDDTO newTD = new TDDTO();
            newTD.setNb(1);
            newTD.setNbTP(2);
            TDDTO createdTD = tdService.create(newTD);
            CustomLogger.logInfo("Created TD: " + createdTD);

            // Test findById
            TDDTO foundTD = tdService.findById(createdTD.getId());
            CustomLogger.logInfo("Found TD: " + foundTD);

            // Test update
            createdTD.setNbTP(3);
            TDDTO updatedTD = tdService.update(createdTD.getId(), createdTD);
            CustomLogger.logInfo("Updated TD: " + updatedTD);

            // Test getTPs
            List<TPDTO> tps = tdService.getTPs(createdTD.getId());
            CustomLogger.logInfo("TD TPs: " + tps.size());

            // Test generateSchedule
            List<SeanceDTO> schedule = tdService.generateSchedule(createdTD.getId());
            CustomLogger.logInfo("TD Schedule: " + schedule.size() + " sessions");

            // Test getEtudiants
            List<EtudiantDTO> students = tdService.getEtudiants(createdTD.getId());
            CustomLogger.logInfo("TD Students: " + students.size());

            // Test delete
            tdService.delete(createdTD.getId());
            CustomLogger.logInfo("Deleted TD with ID: " + createdTD.getId());

        } catch (CustomException e) {
            CustomLogger.logError("TDService test failed: " + e.getMessage());
            throw e;
        }
    }

    public void testTPService() throws CustomException {
        CustomLogger.logInfo("=================== Testing TPService ===================");

        try {
            // Test findAll
            List<TPDTO> allTPs = tpService.findAll();
            CustomLogger.logInfo("All TPs: " + allTPs.size());

            // Test create
            TPDTO newTP = new TPDTO();
            newTP.setNb(1);
            TPDTO createdTP = tpService.create(newTP);
            CustomLogger.logInfo("Created TP: " + createdTP);

            // Test findById
            TPDTO foundTP = tpService.findById(createdTP.getId());
            CustomLogger.logInfo("Found TP: " + foundTP);

            // Test update
            createdTP.setNb(2);
            TPDTO updatedTP = tpService.update(createdTP.getId(), createdTP);
            CustomLogger.logInfo("Updated TP: " + updatedTP);

            // Test getStudents
            List<EtudiantDTO> students = tpService.getStudents(createdTP.getId());
            CustomLogger.logInfo("TP Students: " + students.size());

            // Test generateSchedule
            List<SeanceDTO> schedule = tpService.generateSchedule(createdTP.getId());
            CustomLogger.logInfo("TP Schedule: " + schedule.size() + " sessions");

            // Test getEtudiants
            List<EtudiantDTO> allStudents = tpService.getEtudiants(createdTP.getId());
            CustomLogger.logInfo("TP All Students: " + allStudents.size());

            // Test delete
            tpService.delete(createdTP.getId());
            CustomLogger.logInfo("Deleted TP with ID: " + createdTP.getId());

        } catch (CustomException e) {
            CustomLogger.logError("TPService test failed: " + e.getMessage());
            throw e;
        }
    }
}